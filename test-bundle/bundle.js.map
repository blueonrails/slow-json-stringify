{"version":3,"file":"bundle.js","sources":["../src/sjs.js"],"sourcesContent":["const _prepare  = require('./_prepare');\nconst _makeQueue  = require('./_makeQueue');\nconst _makeChunks  = require('./_makeChunks');\nconst _select  = require('./_select');\nconst { attr, escape }  = require('./_utils');\n\n// Doing a lot of preparation work before returning the final function responsible for\n// the stringification.\nconst sjs = (schema) => {\n  const { preparedString, preparedSchema } = _prepare(schema);\n\n  // Providing preparedSchema for univocal correspondence between created queue and chunks.\n  // Provided original schema to keep track of the original properties that gets destroied\n  // during schema preparation => e.g. array stringification method.\n  const queue = _makeQueue(preparedSchema, schema);\n  const chunks = _makeChunks(preparedString, queue);\n  const selectChunk = _select(chunks);\n\n  const { length } = queue;\n\n  // Exposed function\n  return (obj) => {\n    let temp = '';\n    const hydratedQueue = queue.map(({\n      serializer,\n      find,\n    }) => serializer(find(obj)))\n\n    /**\n     * Flags should live here..\n     * here it should be the place where the triad\n     * prev, curr, next is stored with booleans\n     * to minimize object accesses\n     */\n    const state = [0, 0, 0];\n\n    // Ditching old implementation for a **MUCH** faster while\n    let i = 0;\n    while (true) {\n      if (i === length) break;\n\n      // Bug introduced by having a chunk that is not aware to be the last chunk\n      temp += selectChunk(hydratedQueue, i);\n\n      i += 1;\n    }\n\n    // Mutation probably introduced by repeated usage of `flag`\n    const { flag, pure, prevUndef } = chunks[chunks.length - 1];\n\n    // Should change method here\n    return temp + (flag ? prevUndef : pure);\n  };\n};\n\nmodule.exports = {\n  sjs,\n  attr,\n  escape,\n};\n"],"names":["_prepare","require","_makeQueue","_makeChunks","_select","module","exports","sjs","schema","preparedString","queue","preparedSchema","chunks","selectChunk","length","obj","temp","hydratedQueue","map","serializer","find","i","flag","prevUndef","pure","attr","escape"],"mappings":"AAAA,IAAMA,EAAYC,QAAQ,cACpBC,EAAcD,QAAQ,gBACtBE,EAAeF,QAAQ,iBACvBG,EAAWH,QAAQ,eACCA,QAAQ,YAmDlCI,OAAOC,QAAU,CACfC,IAhDU,SAACC,GACX,MAA2CR,EAASQ,GAA5CC,IAAAA,eAKFC,EAAQR,IALUS,eAKiBH,GACnCI,EAAST,EAAYM,EAAgBC,GACrCG,EAAcT,EAAQQ,GAEpBE,EAAWJ,EAAXI,OAGR,gBAAQC,GAiBN,IAhBA,IAAIC,EAAO,GACLC,EAAgBP,EAAMQ,IAAI,mBAG1BC,IAFJA,aAEeC,IADfA,MACoBL,MAWlBM,EAAI,EAEFA,IAAMP,GAGVE,GAAQH,EAAYI,EAAeI,GAEnCA,GAAK,EAIP,MAAkCT,EAAOA,EAAOE,OAAS,GAGzD,OAAOE,KAHCM,OAAYC,YAANC,QAShBC,OArDMA,KAsDNC,SAtDYA"}